<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversation Analysis Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        #fileInput {
            margin-bottom: 20px;
        }
        #analyzeBtn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #analyzeBtn:hover {
            background-color: #45a049;
        }
        .highlight {
            background-color: #ffffd0;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Conversation Analysis Dashboard</h1>
        <input type="file" id="fileInput" accept=".csv">
        <button id="analyzeBtn" onclick="analyzeFile()">Analyze Conversation</button>
        
        <div id="dashboard" class="dashboard" style="display:none;">
            <div class="card">
                <h2>Conversation Overview</h2>
                <p>Total Speakers: <span id="totalSpeakers"></span></p>
                <p>Total Exchanges: <span id="totalExchanges"></span></p>
                <p>Duration: <span id="duration"></span></p>
            </div>
            
            <div class="card">
                <h2>Key Topics</h2>
                <ul id="keyTopics"></ul>
            </div>
            
            <div class="card">
                <h2>Speaker Participation</h2>
                <table id="speakerTable">
                    <tr>
                        <th>Speaker</th>
                        <th>Contributions</th>
                        <th>Words</th>
                        <th>Avg Words/Contribution</th>
                    </tr>
                </table>
            </div>
            
            <div class="card">
                <h2>Conversation Flow</h2>
                <div id="conversationFlow"></div>
            </div>
            
            <div class="card">
                <h2>Action Items</h2>
                <ul id="actionItems"></ul>
            </div>
            
            <div class="card">
                <h2>Sentiment Analysis</h2>
                <p>Overall Tone: <span id="overallTone"></span></p>
                <div id="sentimentBreakdown"></div>
            </div>
        </div>
    </div>

    <script>
        function analyzeFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    analyzeContent(content);
                };
                reader.readAsText(file);
            } else {
                alert('Please select a CSV file');
            }
        }

        function analyzeContent(content) {
            const lines = content.split('\n');
            const speakers = {};
            let totalExchanges = 0;
            let currentSpeaker = '';
            let allText = '';
            let conversationFlow = [];

            lines.forEach(line => {
                if (line.trim().startsWith('<v ')) {
                    currentSpeaker = line.trim().match(/<v (.+?)>/)[1];
                    if (!speakers[currentSpeaker]) {
                        speakers[currentSpeaker] = { contributions: 0, words: 0 };
                    }
                } else if (currentSpeaker && line.trim()) {
                    speakers[currentSpeaker].contributions++;
                    const words = line.trim().split(/\s+/);
                    speakers[currentSpeaker].words += words.length;
                    totalExchanges++;
                    allText += line.trim() + ' ';
                    conversationFlow.push({ speaker: currentSpeaker, text: line.trim() });
                }
            });

            updateDashboard(speakers, totalExchanges, allText, conversationFlow);
        }

        function updateDashboard(speakers, totalExchanges, allText, conversationFlow) {
            document.getElementById('totalSpeakers').textContent = Object.keys(speakers).length;
            document.getElementById('totalExchanges').textContent = totalExchanges;
            document.getElementById('duration').textContent = estimateDuration(totalExchanges) + " minutes";

            updateSpeakerTable(speakers);
            updateKeyTopics(allText);
            updateConversationFlow(conversationFlow);
            updateActionItems(allText);
            updateSentimentAnalysis(allText);

            document.getElementById('dashboard').style.display = 'grid';
        }

        function updateSpeakerTable(speakers) {
            const table = document.getElementById('speakerTable');
            table.innerHTML = '<tr><th>Speaker</th><th>Contributions</th><th>Words</th><th>Avg Words/Contribution</th></tr>';

            for (const [speaker, data] of Object.entries(speakers)) {
                const row = table.insertRow();
                row.insertCell(0).textContent = speaker;
                row.insertCell(1).textContent = data.contributions;
                row.insertCell(2).textContent = data.words;
                row.insertCell(3).textContent = (data.words / data.contributions).toFixed(2);
            }
        }

        function updateKeyTopics(text) {
            const words = text.toLowerCase().split(/\W+/);
            const wordFreq = {};
            words.forEach(word => {
                if (word.length > 3) {
                    wordFreq[word] = (wordFreq[word] || 0) + 1;
                }
            });

            const sortedWords = Object.entries(wordFreq).sort((a, b) => b[1] - a[1]);
            const keyTopics = sortedWords.slice(0, 5).map(([word, freq]) => `${word} (${freq})`);

            const topicsList = document.getElementById('keyTopics');
            topicsList.innerHTML = keyTopics.map(topic => `<li>${topic}</li>`).join('');
        }

        function updateConversationFlow(flow) {
            const flowDiv = document.getElementById('conversationFlow');
            flowDiv.innerHTML = flow.slice(0, 10).map(exchange => 
                `<p><strong>${exchange.speaker}:</strong> ${highlightKeywords(exchange.text)}</p>`
            ).join('');
        }

        function updateActionItems(text) {
            const actionKeywords = ['need to', 'should', 'must', 'will', 'going to'];
            const sentences = text.match(/[^\.!\?]+[\.!\?]+/g) || [];
            const actionItems = sentences.filter(sentence => 
                actionKeywords.some(keyword => sentence.toLowerCase().includes(keyword))
            );

            const actionList = document.getElementById('actionItems');
            actionList.innerHTML = actionItems.slice(0, 5).map(item => `<li>${item}</li>`).join('');
        }

        function updateSentimentAnalysis(text) {
            // This is a very basic sentiment analysis. For accurate results, use a proper NLP library or API.
            const positiveWords = ['good', 'great', 'excellent', 'amazing', 'wonderful', 'fantastic'];
            const negativeWords = ['bad', 'poor', 'terrible', 'awful', 'horrible', 'disappointing'];

            const words = text.toLowerCase().split(/\W+/);
            let positiveCount = 0;
            let negativeCount = 0;

            words.forEach(word => {
                if (positiveWords.includes(word)) positiveCount++;
                if (negativeWords.includes(word)) negativeCount++;
            });

            const totalSentimentWords = positiveCount + negativeCount;
            const sentimentScore = totalSentimentWords > 0 
                ? (positiveCount - negativeCount) / totalSentimentWords 
                : 0;

            document.getElementById('overallTone').textContent = 
                sentimentScore > 0.1 ? 'Positive' : sentimentScore < -0.1 ? 'Negative' : 'Neutral';

            document.getElementById('sentimentBreakdown').innerHTML = 
                `Positive words: ${positiveCount}, Negative words: ${negativeCount}`;
        }

        function estimateDuration(exchanges) {
            // Rough estimate: 30 seconds per exchange
            return Math.round(exchanges * 0.5);
        }

        function highlightKeywords(text) {
            const keywords = ['important', 'critical', 'urgent', 'key', 'essential'];
            return keywords.reduce((acc, keyword) => 
                acc.replace(new RegExp(keyword, 'gi'), match => `<span class="highlight">${match}</span>`), text);
        }
    </script>
</body>
</html>
